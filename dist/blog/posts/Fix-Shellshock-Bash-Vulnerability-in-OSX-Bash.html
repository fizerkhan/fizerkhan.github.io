<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/png" href="/images/cabin.png">
    <link href="/styles/main.css" rel="stylesheet">
    <title>Fix Shellshock Bash Vulnerability in OSX Bash</title>
  </head>
  <body>
    <nav id="nav">
      <h1 class="name"><a href="/">Fizer Khan</a></h1>
      <ul class="nav-links">
        <li class="menu icon-menu"></li>
        <li class="text-link"><a href="/about.html">About</a></li>
        <li class="text-link"><a href="/archives.html">Archives</a></li>
      </ul>
      <div class="social-media"><a href="https://github.com/fizerkhan" class="icon-github"></a><a href="https://twitter.com/fizerkhan" class="icon-twitter"></a><a href="http://facebook.com/fizerface" class="icon-facebook"></a></div>
    </nav>
    <div class="content">
      <div class="post-head group"><a href="/blog/posts/Fix-Shellshock-Bash-Vulnerability-in-OSX-Bash.html">
          <h1 class="post-title">Fix Shellshock Bash Vulnerability in OSX Bash</h1></a>
        <h2 class="post-date">2014 &#183; 9 &#183; 27</h2>
      </div>
      <div class="post-body"><p>GNU Bash vulnerability, referred to as <strong>Shellshock</strong> or the <strong>Bash Bug</strong>, was found on Sep 24, 2014.
The <strong>Shellshock</strong> vulnerability is very widespread and even more so than the OpenSSL Heartbleed bug
 So it is highly recommended that affected systems are properly updated to fix or mitigate the vulnerability as soon as possible.</p>
<a name="what-is-shellshock" class="anchor" href="#what-is-shellshock"><h3>What is Shellshock</h3>
</a><pre><code><div class="highlight"><pre><span class="nx">GNU</span> <span class="nx">Bash</span> <span class="nx">through</span> <span class="mf">4.3</span> <span class="nx">processes</span> <span class="nx">trailing</span> <span class="nx">strings</span> <span class="nx">after</span> <span class="kd">function</span> <span class="nx">definitions</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">environment</span> <span class="nx">variables</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">allows</span> <span class="nx">remote</span> <span class="nx">attackers</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">arbitrary</span> <span class="nx">code</span> <span class="nx">via</span> <span class="nx">a</span> <span class="nx">crafted</span> <span class="nx">environment</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">demonstrated</span> <span class="nx">by</span> <span class="nx">vectors</span> <span class="nx">involving</span> <span class="nx">the</span> <span class="nx">ForceCommand</span> <span class="nx">feature</span> <span class="k">in</span> <span class="nx">OpenSSH</span> <span class="nx">sshd</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">mod_cgi</span> <span class="nx">and</span> <span class="nx">mod_cgid</span> <span class="nx">modules</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">Apache</span> <span class="nx">HTTP</span> <span class="nx">Server</span><span class="p">,</span> <span class="nx">scripts</span> <span class="nx">executed</span> <span class="nx">by</span> <span class="nx">unspecified</span> <span class="nx">DHCP</span> <span class="nx">clients</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">other</span> <span class="nx">situations</span> <span class="k">in</span> <span class="nx">which</span> <span class="nx">setting</span> <span class="nx">the</span> <span class="nx">environment</span> <span class="nx">occurs</span> <span class="nx">across</span> <span class="nx">a</span> <span class="nx">privilege</span> <span class="nx">boundary</span> <span class="nx">from</span> <span class="nx">Bash</span> <span class="nx">execution</span><span class="p">.</span>
</pre></div>
</code></pre>
<p>To know more about <strong>Shellshock</strong>, read an amazing <a href="http://www.troyhunt.com/2014/09/everything-you-need-to-know-about.html">article from Troy Hunt</a></p>
<a name="check-system-vulnerability" class="anchor" href="#check-system-vulnerability"><h3>Check System Vulnerability</h3>
</a><p>You can check the system for Shellshock vulnerability by running following command in bash</p>
<pre><code><div class="highlight"><pre><span class="nx">env</span> <span class="nx">Y</span><span class="o">=</span><span class="s1">&#39;() { :;}; echo I am vulnerable!&#39;</span> <span class="nx">bash</span> <span class="o">-</span><span class="nx">c</span> <span class="s2">&quot;echo This is Bash&quot;</span>
</pre></div>
</code></pre>
<p>If your version of Bash is vulnerable, then you will see following output</p>
<pre><code><div class="highlight"><pre><span class="nx">I</span> <span class="nx">am</span> <span class="nx">vulnerable</span>
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">Bash</span>
</pre></div>
</code></pre>
<p>Instead of <strong>echo I am vulnerable!</strong> portion, attacker can run any command;
arbitrary code following a function definition within an environment variable assignment.
If your system don&#39;t have Shellshock vulnerability, then you will see following output</p>
<pre><code><div class="highlight"><pre><span class="nx">bash</span><span class="o">:</span> <span class="nx">warning</span><span class="o">:</span> <span class="nx">Y</span><span class="o">:</span> <span class="nx">ignoring</span> <span class="kd">function</span> <span class="nx">definition</span> <span class="nx">attempt</span>
<span class="nx">bash</span><span class="o">:</span> <span class="nx">error</span> <span class="nx">importing</span> <span class="kd">function</span> <span class="nx">definition</span> <span class="k">for</span> <span class="err">`</span><span class="nx">Y</span><span class="err">&#39;</span>
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">Bash</span>
</pre></div>
</code></pre>
<a name="how-to-fix-in-mac-osx" class="anchor" href="#how-to-fix-in-mac-osx"><h3>How to fix in Mac OSX</h3>
</a><p>If your bash is vulnerable, then  you can install latest version of bash as follows, provided that you have XCode installed,</p>
<pre><code><div class="highlight"><pre><span class="nx">$</span> <span class="nx">mkdir</span> <span class="nx">bash</span><span class="o">-</span><span class="nx">fix</span>
<span class="nx">$</span> <span class="nx">cd</span> <span class="nx">bash</span><span class="o">-</span><span class="nx">fix</span>
<span class="nx">$</span> <span class="nx">curl</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//opensource.apple.com/tarballs/bash/bash-92.tar.gz | tar zxf -</span>
<span class="nx">$</span> <span class="nx">cd</span> <span class="nx">bash</span><span class="o">-</span><span class="mi">92</span><span class="o">/</span><span class="nx">bash</span><span class="o">-</span><span class="mf">3.2</span>
<span class="nx">$</span> <span class="nx">curl</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//ftp.gnu.org/pub/gnu/bash/bash-3.2-patches/bash32-052 | patch -p0</span>
<span class="nx">$</span> <span class="nx">curl</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//ftp.gnu.org/pub/gnu/bash/bash-3.2-patches/bash32-053 | patch -p0</span>
<span class="nx">$</span> <span class="nx">cd</span> <span class="p">..</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">xcodebuild</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">cp</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span><span class="p">.</span><span class="nx">old</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">cp</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span><span class="p">.</span><span class="nx">old</span>
<span class="nx">$</span> <span class="nx">build</span><span class="o">/</span><span class="nx">Release</span><span class="o">/</span><span class="nx">bash</span> <span class="o">--</span><span class="nx">version</span> <span class="err">#</span> <span class="nx">GNU</span> <span class="nx">bash</span><span class="p">,</span> <span class="nx">version</span> <span class="mf">3.2</span><span class="p">.</span><span class="mi">53</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nx">release</span>
<span class="nx">$</span> <span class="nx">build</span><span class="o">/</span><span class="nx">Release</span><span class="o">/</span><span class="nx">sh</span> <span class="o">--</span><span class="nx">version</span>   <span class="err">#</span> <span class="nx">GNU</span> <span class="nx">bash</span><span class="p">,</span> <span class="nx">version</span> <span class="mf">3.2</span><span class="p">.</span><span class="mi">53</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nx">release</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">cp</span> <span class="nx">build</span><span class="o">/</span><span class="nx">Release</span><span class="o">/</span><span class="nx">bash</span> <span class="o">/</span><span class="nx">bin</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">cp</span> <span class="nx">build</span><span class="o">/</span><span class="nx">Release</span><span class="o">/</span><span class="nx">sh</span> <span class="o">/</span><span class="nx">bin</span>
</pre></div>
</code></pre>
<p>Once you installed, check your bash version(<code>bash --version</code>), it should be
<code>GNU bash, version 3.2.53(1)-release</code></p>
<p>For security reason, you have to remove the executable permission from older bash</p>
<pre><code><div class="highlight"><pre><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">chmod</span> <span class="nx">a</span><span class="o">-</span><span class="nx">x</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span><span class="p">.</span><span class="nx">old</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span><span class="p">.</span><span class="nx">old</span>
</pre></div>
</code></pre>
<p>That&#39;s it. Keep in mind that this fix is temporary.
We have to wait for real fix until apple releases it.</p>
<p>If you using Linux distribution, please read <a href="https://www.digitalocean.com/community/tutorials/how-to-protect-your-server-against-the-shellshock-bash-vulnerability">Digital Ocean blog on Shellshock</a></p>
<a name="kudos" class="anchor" href="#kudos"><h3>Kudos</h3>
</a><ul>
<li><a href="http://apple.stackexchange.com/questions/146849/how-do-i-recompile-bash-to-avoid-shellshock-the-remote-exploit-cve-2014-6271-an">AlBlue at stackexchange</a></li>
<li><a href="http://www.troyhunt.com/">Troy Hunt</a></li>
</ul>
</div>
      <div class="social"><a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a><a href="https://twitter.com/share" data-via="fizerkhan" data-lang="en" class="twitter-share-button">Tweet</a>
        <div data-action="share" data-annotation="bubble" class="g-plus"></div>
      </div>
      <hr class="style-eight">
      <div id="comments">
        <div id="disqus_thread"></div>
      </div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'fizerkhan'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by<span class="logo-disqus">Disqus</span></a>
      <script>
        (function(d, t) {
          var g = d.createElement(t),
              s = d.getElementsByTagName(t)[0];
          g.src = '//hnbutton.appspot.com/static/hn.min.js';
          s.parentNode.insertBefore(g, s);
        }(document, 'script'));
      </script>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      <script>
        (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
        
      </script>
    </div><a href="http://fizerkhan.com/"><img src="/images/cabin.png" class="cabin"></a>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script src="/scripts/main.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-41972683-1', 'fizerkhan.com');
      ga('send', 'pageview');
    </script>
  </body>
</html>